title: "Health summary"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{health_summary}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include=FALSE}
knitr::opts_chunk$set(comment = "#>", collapse = TRUE, message = FALSE, warning = FALSE)
knitr::opts_knit$set(purl = FALSE)
```

## Scope
Quick QA helper that summarizes numeric columns: counts, missingness, mean, sd, median, and 25th/75th percentiles. If `cols` is `NULL`, it auto-detects numeric columns; otherwise it summarizes the intersection of `cols` and existing names.

## When to use
- You want a fast completeness/central tendency check on numeric outputs (original or derived markers).
- You need to confirm which columns are numeric and how many NAs they carry before export or modeling.
- You prefer a silent, non-destructive helper that ignores non-numeric columns automatically.

## Inputs and requirements
- `x`: data.frame/tibble.
- `cols` (optional): character vector; if `NULL`, all numeric columns are summarized. Nonexistent names are ignored.
- Only numeric columns are summarized; non-numeric are skipped.

## Load packages and data
Use the bundled simulated data for runnable examples and add a grouping factor to show that non-numeric columns are ignored.

```{r}
library(HealthMarkers)
library(dplyr)
library(tibble)

sim_path <- system.file("extdata", "simulated_hm_data.rds", package = "HealthMarkers")
sim <- readRDS(sim_path)
sim_small <- sim[1:30, ]

set.seed(123)
demo <- sim_small %>%
  transmute(
    BMI,
    TG,
    HDL_c,
    group = factor(sample(c("A", "B"), n(), replace = TRUE))
  )
```

## Column selection
- Default: all numeric columns are summarized; non-numeric (e.g., `group`) are skipped.
- Optional: supply `cols` to restrict to specific numeric columns; names not present are ignored.

## Core calculation
Summarize all numeric columns detected in `demo`.

```{r}
health_summary(demo)
```

Restrict to a subset of columns.

```{r}
health_summary(demo, cols = c("BMI", "TG"))
```

## Inputs and behavior
- Input: any data.frame/tibble; only numeric columns are summarized.
- Missingness: stats are NA-aware (`na.rm = TRUE`); rows are never dropped.
- Units: no assumptions beyond numeric values; you interpret the units.
- Empty case: if no numeric columns are found, returns an empty tibble with the expected column names.

## Tips
- Run after computing markers to spot missingness or odd distributions before exporting.
- Reuse during data cleaningâ€”non-numeric columns are ignored, so it is safe to call repeatedly.
- Pair with aggregators: summarize derived markers right after calling `all_health_markers()` or `metabolic_markers()`.
- Use `cols` to focus on newly derived marker columns without summarizing the full dataset.

## After computing markers
Summarize a few derived columns from `all_health_markers()` (glycemic + lipid) to check completeness.

```{r}
hm_input <- sim_small
if (!"glucose" %in% names(hm_input) && "G0" %in% names(hm_input)) {
  hm_input$glucose <- hm_input$G0  # reuse fasting glucose for TyG and METS_IR
}

hm <- all_health_markers(
  data = hm_input,
  col_map = list(
    glucose = "glucose",
    TG = "TG",
    HDL_c = "HDL_c",
    BMI = "BMI"
  ),
  which = c("glycemic", "lipid"),
  include_insulin = FALSE,
  verbose = FALSE
)

derived_cols <- c("TyG_index", "AIP", "SPISE", "METS_IR")
health_summary(hm, cols = derived_cols)
```

Here `health_summary()` reports row counts and missingness for the derived markers so you can decide whether to impute, drop rows, or adjust inputs before export.

