---
title: "cvd_marker_aip"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{cvd_marker_aip}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include=FALSE}
knitr::opts_chunk$set(comment = "#", collapse = TRUE)
knitr::opts_knit$set(purl = FALSE)
```

## Overview

`cvd_marker_aip()` computes the Atherogenic Index of Plasma (AIP) as `log10(TG / HDL_c)`. It validates required lipid inputs, coerces non-numeric columns, and handles missing/non-finite values per `na_action`.

## Inputs

- `data`: data.frame/tibble with triglycerides and HDL cholesterol.
- `col_map`: named list mapping `TG` and `HDL_c` column names (defaults: `TG`, `HDL_c`).
- Inputs are coerced to numeric; non-finite values become `NA`.

## Arguments

- `na_action = c("keep","omit","error")`: missing-data policy for TG/HDL (`keep` retains NA results; `omit` drops rows; `error` aborts).
- `col_map`: rename required columns if needed.
- `verbose = FALSE`: emit progress via `hm_inform()`.

## Output

Returns a tibble with columns `model = "AIP"` and `value` (numeric). Rows are dropped only when `na_action = "omit"`; otherwise rows with missing inputs yield `NA` values.

## Examples

```{r}
library(HealthMarkers)
library(tibble)

lipids <- tibble(TG = c(150, 90), HDL_c = c(40, 60))

cvd_marker_aip(
  data = lipids,
  col_map = list(TG = "TG", HDL_c = "HDL_c"),
  na_action = "keep",
  verbose = FALSE
)
```

## Examples

Drop rows with missing inputs and compute AIP on a renamed HDL column:

```{r}
lipids2 <- tibble(TG = c(150, 90, NA), HDL = c(40, 60, 55))

cvd_marker_aip(
  data = lipids2,
  col_map = list(TG = "TG", HDL_c = "HDL"),
  na_action = "omit",
  verbose = FALSE
)
```

## Notes

- Non-numeric lipid columns are coerced with warnings; non-finite values are set to `NA` before calculation.
- When `na_action = "error"`, any missing/non-finite TG or HDL aborts; use `omit` to filter or `keep` to retain NA outputs.
- Output uses the provided units (assumed mg/dL) without unit conversion.
