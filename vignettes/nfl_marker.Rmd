---
title: "NfL Marker"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{NfL Marker}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include=FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  message = FALSE,
  warning = FALSE
)
knitr::opts_knit$set(purl = FALSE)
```

## Scope

Validate and return Neurofilament Light Chain (NfL) values with optional missing/extreme handling; no scoring, centiles, or unit conversion.

## When to use

- You have NfL measurements and need lightweight validation plus NA/extreme policies before modeling or export.
- You do not need reference ranges or age-adjusted centiles—just cleaned values.
- You want broad defaults but the ability to tighten extreme bounds to your assay range.

## Inputs

- `data`: data.frame/tibble containing an NfL column.
- `col_map`: named list mapping `nfl` to the NfL column (default `NfL`); numeric is expected, coercion warns on NA introduction.
- `na_action`: `keep` (default) propagates NA; `omit` drops rows with missing NfL; `error` aborts; `ignore`/`warn` act like keep (`warn` also messages on missing).
- `check_extreme`: set TRUE to scan using `extreme_action` (`warn`/`cap`/`error`/`ignore`/`NA`).
- `extreme_rules`: override the broad default `nfl` range (0, 1e6) in your input units.
- `verbose`: optional progress messages.

## Quick start

```{r}
library(HealthMarkers)
library(tibble)

df <- tibble(NfL = c(12.5, 18.2, NA, 450000))

nfl_marker(
  data = df,
  col_map = list(nfl = "NfL"),
  na_action = "keep",
  check_extreme = FALSE,
  verbose = FALSE
)
```

## Extreme scan and cap

```{r}
nfl_marker(
  data = df,
  col_map = list(nfl = "NfL"),
  na_action = "warn",
  check_extreme = TRUE,
  extreme_action = "cap",
  verbose = TRUE
)
```

## Missing-data policy

```{r}
try(
  nfl_marker(
    data = df,
    col_map = list(nfl = "NfL"),
    na_action = "error"
  )
)
```

## Outputs and expectations

- Returns a tibble with `nfl_value` after applying NA/extreme policies.
- `na_action = "omit"` drops rows with missing NfL; otherwise missing values yield `NA`.
- Extreme handling can warn, cap, NA, ignore, or error; defaults are intentionally broad.

## Tips

- Align units with your assay (e.g., plasma pg/mL); no conversion is performed.
- Tighten `extreme_rules` to the assay’s reportable range to avoid over-broad caps.
- Use `na_action = "omit"` if downstream steps cannot handle missing values; keep/warn during QA to inspect gaps.
