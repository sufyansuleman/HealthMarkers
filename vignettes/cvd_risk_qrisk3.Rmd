---
title: "cvd_risk_qrisk3"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{cvd_risk_qrisk3}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include=FALSE}
knitr::opts_chunk$set(comment = "#", collapse = TRUE)
knitr::opts_knit$set(purl = FALSE)
```

## Overview

`cvd_risk_qrisk3()` wraps `QRISK3::QRISK3_2017()` with optional ID auto-generation, basic type checks, and quiet fallback to `NA` if the backend errors. It computes 10-year QRISK3 scores.

## Required Inputs

- `data`: data.frame/tibble containing all variables required by `QRISK3::QRISK3_2017()` (age, sex, smoking status, blood pressure, cholesterol ratios, comorbidities, etc.).
- `patid` (optional): vector of patient IDs; defaults to `1:nrow(data)` if omitted.
- QRISK3 package must be installed; otherwise the function aborts.

## Key Arguments

- `...`: forwarded directly to `QRISK3::QRISK3_2017()`.
- `patid = NULL`: supply or allow auto-generated IDs.
- `na_warn_prop = 0.2`: reserved for potential warnings when verbose is enabled (inputs are otherwise passed through).
- `verbose = FALSE`: emit minimal progress messages.

## Output Description

Returns a tibble with columns `model = "QRISK3"`, `year = 10`, and `risk`. If the backend errors, an `NA` row is returned.

## Minimal Reproducible Example

QRISK3 requires many inputs; the example is guarded to run only when the package is available:

```{r}
library(HealthMarkers)

if (requireNamespace("QRISK3", quietly = TRUE)) {
  # Replace `your_qrisk3_data` with a data.frame containing the required variables
  # qr <- cvd_risk_qrisk3(your_qrisk3_data, verbose = TRUE)
}
```

## Extended Example

Demonstrate ID auto-generation and error-safe behavior:

```{r}
if (requireNamespace("QRISK3", quietly = TRUE)) {
  # Suppose df has the needed QRISK3 columns but no ID column
  # qr1 <- cvd_risk_qrisk3(df)
  # qr2 <- cvd_risk_qrisk3(df, patid = df$patient_id)
}
```

## Notes / Workflow Integration

- Ensure `QRISK3` is installed; otherwise this wrapper aborts. When invoked through `cvd_risk(model = "ALL")`, missing packages are caught and replaced with `NA` rows.
- Inputs are passed through without full pre-validation to avoid duplicating QRISK3â€™s specification.
- If the backend raises an error, the wrapper returns an `NA` row to maintain rectangular outputs.