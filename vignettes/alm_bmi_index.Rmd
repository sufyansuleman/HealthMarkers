---
title: "alm_bmi_index"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{alm_bmi_index}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include=FALSE}
knitr::opts_chunk$set(comment = "#", collapse = TRUE)
knitr::opts_knit$set(purl = FALSE)
```

## Overview

`alm_bmi_index()` computes ALM/BMI and flags low muscle mass using FNIH cut-points (men < 0.789; women < 0.512). Inputs are validated, optional extreme screening is available, and missing-data handling mirrors other helpers.

## Inputs

- `data`: data.frame/tibble with ALM (kg), BMI (kg/m^2), and sex.
- `col_map`: named list for `alm`, `bmi`, `sex` (defaults: ALM_kg, BMI, Sex).
- Inputs are coerced to numeric; sex normalized via first letter (m/f/1/0). Non-finite become `NA`.

## Arguments

- `na_action = c("keep","omit","error","ignore","warn")`: missing-data policy (`ignore`/`warn` behave like `keep`).
- `check_extreme = FALSE`: enable range screening (defaults: ALM 5–40 kg, BMI 10–60 kg/m^2).
- `extreme_action = c("warn","cap","error","ignore","NA")`: handling for extremes when screening is on (`cap` trims to bounds; `NA` blanks values).
- `extreme_rules`: optional custom bounds.
- `verbose`: emit progress messages.

## Output

Returns a tibble with:
- `alm_bmi_ratio`
- `low_muscle_mass` (TRUE if ratio below sex-specific cut-point; NA if sex or ratio missing)
Rows drop only when `na_action = "omit"`; otherwise missing inputs propagate `NA`.

## Examples

```{r}
library(HealthMarkers)
library(tibble)

df <- tibble(
  ALM_kg = c(22, 14),
  BMI    = c(27, 24),
  Sex    = c("Male", "Female")
)

alm_bmi_index(
  data = df,
  col_map = list(alm = "ALM_kg", bmi = "BMI", sex = "Sex"),
  na_action = "keep",
  check_extreme = FALSE,
  extreme_action = "warn",
  verbose = FALSE
)
```

## Examples

Drop incomplete rows, screen for extremes, cap to defaults:

```{r}
alm_bmi_index(
  data = df,
  col_map = list(alm = "ALM_kg", bmi = "BMI", sex = "Sex"),
  na_action = "omit",
  check_extreme = TRUE,
  extreme_action = "cap",
  verbose = TRUE
)
```

## Notes

- Sex values are normalized by first letter (m/f/1/0); other values warn and yield `NA` flags.
- Domain warnings are issued for BMI outside 10–60 and ALM outside 5–40 when not using `check_extreme`.
- Use `na_action = "error"` to enforce completeness; `"omit"` drops incomplete rows.
- `extreme_rules` can tighten/loosen bounds for ALM and BMI if population differs.

