---
title: "CVD Risk RiskScorescvd"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{cvd_risk_scorescvd}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include=FALSE}
knitr::opts_chunk$set(comment = "#>", collapse = TRUE, message = FALSE, warning = FALSE)
knitr::opts_knit$set(purl = FALSE)
```

## Scope
Passthrough to `RiskScorescvd::calc_scores()` with guarded optional dependency loading and safe fallback to NA.

## When to use
- You need SCORE2/SCORE2-CKD (or other models provided by RiskScorescvd) via a single call.
- You can install the suggested package `RiskScorescvd`; execution is skipped otherwise.
- You want a wrapper that fails softly to `risk = NA` if the backend errors.

## Inputs and requirements
- `data`: data.frame/tibble containing all fields required by your chosen RiskScorescvd model(s).
- Additional arguments: forwarded to `RiskScorescvd::calc_scores()` (e.g., model selection, region settings).
- NA handling is delegated to the backend; the wrapper retries on a trimmed slice (up to 20 rows) before returning a single NA row.

## Load packages and data
Use 30 simulated rows. Supply any additional fields required by your chosen RiskScorescvd models before calling.

```{r}
library(HealthMarkers)
library(dplyr)

sim_path <- system.file("extdata", "simulated_hm_data.rds", package = "HealthMarkers")
sim <- readRDS(sim_path)
sim_small <- sim[1:30, ]
```

## Run RiskScorescvd
Execute only when `RiskScorescvd` is available. Backend errors fall back to a single NA row.

```{r eval = requireNamespace("RiskScorescvd", quietly = TRUE)}
scores <- cvd_risk_scorescvd(sim_small)

head(scores)
```

## Tips
- Requires the suggested package `RiskScorescvd`; when absent, chunks are skipped and the function aborts with an informative error.
- Supply every required column for the chosen RiskScorescvd model; missing inputs will yield `risk = NA` via the wrapperâ€™s graceful fallback.
- The wrapper retries on the first 20 rows if the full data fails (helpful for SCORE2 edge cases in simulated data).
- Extend or rename inputs in `sim_small` as needed before calling.
- Also available via `cvd_risk(model = "RiskScorescvd")`.
