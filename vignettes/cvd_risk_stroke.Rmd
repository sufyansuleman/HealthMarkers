---
title: "CVD Risk Stroke"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{cvd_risk_stroke}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include=FALSE}
knitr::opts_chunk$set(comment = "#>", collapse = TRUE, message = FALSE, warning = FALSE)
knitr::opts_knit$set(purl = FALSE)
```

## Scope
Run the Pooled Cohort 10-year stroke risk calculator with guarded optional dependency loading and clear input expectations.

## When to use
- You need ACC/AHA Pooled Cohort 10-year stroke risk on U.S. adults with standard clinical inputs.
- You want NA-tolerant behavior: backend returns `risk = NA` on invalid rows rather than aborting.
- You can install the suggested package `PooledCohort` (required for execution).

## Inputs and requirements
- Required columns: `age`, `sex` (1 = male, 0 = female), `race` ("white","black","other"), `smoker` (logical), `total_chol`, `HDL_c`, `sbp`, `bp_treated` (logical), `diabetes` (logical), `bmi`.
- Units: cholesterol mg/dL, blood pressure mmHg, BMI kg/m^2.
- Verbose mode runs a lightweight quality scan (non-finite, high/all NA counts).

## Load packages and data
Create a small synthetic data frame with correctly encoded inputs (sex = 1/0, race = white/black/other) to ensure non-NA output.

```{r}
library(HealthMarkers)
library(dplyr)

stroke_data <- tibble::tibble(
  age         = c(55, 60),
  sex         = c(1, 0),                 # 1 = male, 0 = female
  race        = c("white", "black"),   # PooledCohort only accepts black/white
  smoker      = c(FALSE, TRUE),
  total_chol  = c(200, 180),             # mg/dL
  HDL_c       = c(50, 55),               # mg/dL
  sbp         = c(140, 130),             # mmHg
  bp_treated  = c(FALSE, TRUE),
  diabetes    = c(FALSE, FALSE),
  bmi         = c(27, 30)
)
```

## Stroke risk
Execute only when `PooledCohort` is available.

```{r eval = requireNamespace("PooledCohort", quietly = TRUE)}
stroke_out <- cvd_risk_stroke(data = stroke_data, verbose = FALSE)

head(stroke_out)
```

## Notes on equation version
This wrapper uses `equation_version = "Goff_2013"` (PCE stroke component), avoiding PREVENT CKD inputs.

## Tips
- Requires the suggested package `PooledCohort`; when absent, chunks are skipped and the function aborts with an informative error.
- Backend handles its own NA policy; invalid inputs return `risk = NA` rather than stopping the pipeline.
- Set `verbose = TRUE` to see a quick input quality summary before calling the calculator.
- Also available via `cvd_risk(model = "Stroke")`.
